{
  "title": "SSL Certificate Renewal",
  "id": "ssl-renewal",
  "service": "Security",
  "category": "Maintenance",
  "tags": ["ssl", "certbot", "nginx", "security"],
  "shortDescription": "Renewal process for Let's Encrypt certificates.",
  "fullDescription": "Detailed steps to manually renew, verify, and deploy SSL certificates for web servers.",
  "type": "qrun",
  "steps": [
    {
      "title": "Check Expiry Date",
      "content": [
        { "type": "text", "text": "Verify which domains are expiring soon." },
        { "type": "code", "language": "bash", "code": "openssl x509 -enddate -noout -in /etc/letsencrypt/live/example.com/cert.pem" }
      ]
    },
    {
      "title": "Stop Web Server (If Standalone)",
      "content": [
        { "type": "text", "text": "If using standalone mode, stop Nginx/Apache to free port 80." },
        { "type": "code", "language": "bash", "code": "sudo systemctl stop nginx" }
      ]
    },
    {
      "title": "Run Certbot Renewal",
      "content": [
        { "type": "text", "text": "Request a new certificate from Let's Encrypt." },
        { "type": "code", "language": "bash", "code": "sudo certbot renew --force-renewal" }
      ]
    },
    {
      "title": "Verify New Certificate",
      "content": [
        { "type": "text", "text": "<strong>Check the path:</strong> /etc/letsencrypt/live/example.com/" }
      ]
    },
    {
      "title": "Start Web Server",
      "content": [
        { "type": "text", "text": "Bring the web server back online." },
        { "type": "code", "language": "bash", "code": "sudo systemctl start nginx" }
      ]
    },
    {
      "title": "Test HTTPS Connection",
      "content": [
        { "type": "text", "text": "Verify the new cert is being served." },
        { "type": "code", "language": "bash", "code": "curl -vI https://example.com" }
      ]
    },
    {
      "title": "Check OCSP Stapling",
      "content": [
        { "type": "text", "text": "Ensure OCSP response is valid." },
        { "type": "code", "language": "bash", "code": "openssl s_client -connect example.com:443 -status" }
      ]
    },
    {
      "title": "Update Load Balancer (If needed)",
      "content": [
        { "type": "text", "text": "If running behind an LB, upload the new fullchain.pem and privkey.pem." }
      ]
    },
    {
      "title": "Distribute to Cluster",
      "content": [
        { "type": "text", "text": "Copy certs to other nodes if not shared storage." },
        { "type": "code", "language": "bash", "code": "scp -r /etc/letsencrypt/live/example.com user@node2:/etc/letsencrypt/live/" }
      ]
    },
    {
      "title": "Reload Dependent Services",
      "content": [
        { "type": "text", "text": "Restart any other services using this cert (e.g., Postfix, Dovecot)." },
        { "type": "code", "language": "bash", "code": "sudo systemctl restart postfix" }
      ]
    }
  ]
}
